<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AR Christmas Tree</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
  <style>
    body { margin: 0; overflow: hidden; background: #02040a; color: #e5f4ff; font-family: Arial, sans-serif; }
    #help { position: fixed; top: 12px; left: 12px; padding: 10px 12px; background: rgba(0, 0, 0, 0.55); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; max-width: 320px; line-height: 1.35; }
    #help a { color: #7cd3ff; }
    #status { position: fixed; bottom: 12px; left: 12px; padding: 10px 12px; background: rgba(0, 0, 0, 0.55); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; max-width: 360px; line-height: 1.35; color: #ffcccc; font-size: 14px; }
  </style>
</head>
<body>
  <div id="help">
    Allow camera access, point at your custom marker, and watch the tree land on it.
    The tree only appears when the preview image <code>2.png</code> (generated with <code>pattern-2.patt</code>) is in view.
  </div>
  <div id="status" hidden></div>

  <a-scene
    embedded
    vr-mode-ui="enabled: false"
    renderer="antialias: true"
    arjs="sourceType: webcam; facingMode: environment; sourceWidth: 1280; sourceHeight: 720; displayWidth: 1280; displayHeight: 720; debugUIEnabled: false;"
  >
    <a-assets>
      <a-mixin id="light-bulb" geometry="primitive: sphere; radius: 0.04" material="color: #ffd45c; emissive: #ffd45c"></a-mixin>
    </a-assets>

    <a-marker type="pattern" url="pattern-2.patt">
      <a-entity id="tree" position="0 0 0" rotation="-90 0 0" scale="0.7 0.7 0.7">
        <!-- Trunk -->
        <a-cylinder position="0 0.18 0" radius="0.12" height="0.35" color="#5b3a1a"></a-cylinder>
        <!-- Layers of pine -->
        <a-cone position="0 0.45 0" radius-bottom="0.5" radius-top="0.05" height="0.55" color="#1f8a43"></a-cone>
        <a-cone position="0 0.8 0" radius-bottom="0.4" radius-top="0.04" height="0.5" color="#1a6f37"></a-cone>
        <a-cone position="0 1.1 0" radius-bottom="0.32" radius-top="0.03" height="0.45" color="#13582c"></a-cone>
        <!-- Star -->
        <a-octahedron position="0 1.35 0" radius="0.08" color="#ffd45c" material="emissive: #ffd45c; emissiveIntensity: 1.5"></a-octahedron>
        <!-- Presents -->
        <a-box depth="0.22" height="0.18" width="0.22" position="0.3 0.09 0.05" color="#c43a3a"></a-box>
        <a-box depth="0.2" height="0.16" width="0.2" position="-0.28 0.08 -0.08" rotation="0 20 0" color="#2a7bd6"></a-box>
        <!-- Lights -->
        <a-entity mixin="light-bulb" position="0.25 0.55 0.18" animation="property: material.emissiveIntensity; from: 0.1; to: 2; dir: alternate; loop: true; dur: 500; delay: 0"></a-entity>
        <a-entity mixin="light-bulb" position="-0.22 0.7 -0.14" animation="property: material.emissiveIntensity; from: 0.1; to: 2; dir: alternate; loop: true; dur: 600; delay: 200"></a-entity>
        <a-entity mixin="light-bulb" position="0.12 0.95 -0.22" animation="property: material.emissiveIntensity; from: 0.1; to: 2; dir: alternate; loop: true; dur: 550; delay: 120"></a-entity>
        <a-entity mixin="light-bulb" position="-0.12 0.6 0.24" animation="property: material.emissiveIntensity; from: 0.1; to: 2; dir: alternate; loop: true; dur: 520; delay: 320"></a-entity>
        <a-entity mixin="light-bulb" position="0.18 0.83 0.14" animation="property: material.emissiveIntensity; from: 0.1; to: 2; dir: alternate; loop: true; dur: 580; delay: 260"></a-entity>
        <a-entity mixin="light-bulb" position="-0.15 1.05 0.05" animation="property: material.emissiveIntensity; from: 0.1; to: 2; dir: alternate; loop: true; dur: 480; delay: 80"></a-entity>
        <!-- Greeting -->
        <a-text value="Merry Christmas" position="0 1.5 0" rotation="90 0 0" align="center" color="#e5f4ff" width="2.5" animation="property: position; from: 0 1.45 0; to: 0 1.55 0; dir: alternate; loop: true; dur: 1400"></a-text>
      </a-entity>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    (function () {
      const statusBox = document.getElementById('status');
      function showStatus(message) {
        statusBox.textContent = message;
        statusBox.hidden = !message;
      }

      // Prefer listing devices to give a clearer hint if no camera is found.
      if (navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {
        navigator.mediaDevices.enumerateDevices()
          .then(devices => {
            const videoInputs = devices.filter(d => d.kind === 'videoinput');
            if (!videoInputs.length) {
              showStatus('No camera detected. Plug one in or try on a phone, then reload.');
            }
          })
          .catch(() => {
            /* ignore enumeration errors */
          });
      }

      // AR.js emits arjs-video-error on camera failure.
      document.querySelector('a-scene').addEventListener('arjs-video-error', e => {
        const err = e && e.detail ? e.detail : {};
        const name = err.name || 'UnknownError';
        const msg = err.message || 'Check camera permissions or availability.';
        showStatus(`Webcam Error: ${name} â€” ${msg} (try switching facingMode to "environment" on phones).`);
      });
    })();
  </script>
</body>
</html>
